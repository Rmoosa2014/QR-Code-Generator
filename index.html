<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR CODE STUDIO by Riyas</title>
    
    <!-- External Libraries for Advanced Features -->
    <script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary-green: #6eb944;
            --primary-gray: #414042;
            --bg-light: #f4f4f4;
            --white: #ffffff;
            --border: #e0e0e0;
            --text-muted: #888888;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-light);
            color: var(--primary-gray);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px; /* Reduced padding */
        }

        /* --- Header --- */
        header {
            text-align: center;
            margin-bottom: 15px; /* Reduced margin */
            flex-shrink: 0;
        }

        h1 {
            color: var(--primary-green);
            font-size: 1.8rem; /* Compact size */
            font-weight: 800;
            letter-spacing: -0.5px;
            margin-bottom: 0;
            text-transform: uppercase;
            line-height: 1.2;
        }

        h1 span {
            color: var(--primary-green);
        }

        p.subtitle {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 2px;
        }

        /* --- Layout --- */
        .app-container {
            max-width: 1000px; /* Slightly tighter width */
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            overflow: hidden;
            padding-bottom: 5px;
        }

        @media (max-width: 900px) {
            .app-container {
                grid-template-columns: 1fr;
                overflow-y: auto;
                display: block;
                padding-bottom: 20px;
            }
            body {
                height: auto;
                overflow-y: auto;
            }
        }

        /* --- Cards --- */
        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 20px; /* Reduced padding */
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            height: 100%;
        }

        /* Compact content area */
        .card-content {
            display: flex;
            flex-direction: column;
            gap: 12px; /* Uniform gap between sections */
            height: 100%;
            justify-content: space-between; /* Distribute space */
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bg-light);
            color: var(--primary-gray);
            flex-shrink: 0;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* --- Form Elements --- */
        .form-section {
            /* Removed margin bottom in favor of flex gap in parent */
        }

        label {
            display: block;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-wrapper {
            position: relative;
        }

        input[type="text"], 
        input[type="url"],
        input[type="file"] {
            width: 100%;
            padding: 8px 10px; /* Compact padding */
            border: 2px solid var(--bg-light);
            border-radius: 6px;
            font-size: 0.85rem;
            transition: all 0.2s;
            outline: none;
            color: var(--primary-gray);
            background: #fff;
        }

        input[type="text"]:focus, 
        input[type="url"]:focus {
            border-color: var(--primary-green);
        }

        .helper-text {
            font-size: 0.65rem;
            color: #aaa;
            margin-top: 2px;
            text-align: right;
        }

        /* --- Custom Checkbox --- */
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            cursor: pointer;
        }
        
        input[type="checkbox"] {
            accent-color: var(--primary-green);
            width: 14px;
            height: 14px;
            cursor: pointer;
        }

        /* --- Option Grids --- */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .option-btn {
            padding: 6px 2px;
            border: 2px solid var(--bg-light);
            background: var(--white);
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            color: #666;
            transition: all 0.2s;
            text-transform: capitalize;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .option-btn:hover { border-color: #ddd; }
        .option-btn.active {
            border-color: var(--primary-green);
            background-color: #f0f9eb;
            color: var(--primary-green);
        }

        /* --- Color Picker --- */
        .color-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .color-dot {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .color-dot:hover { transform: scale(1.1); }
        .color-dot.active { border-color: var(--primary-gray); transform: scale(1.1); }

        .custom-picker-wrapper {
            position: relative;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: conic-gradient(red, yellow, lime, aqua, blue, magenta, red);
            border: 2px solid var(--border);
            cursor: pointer;
            margin-left: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .custom-picker-wrapper::after {
            content: '+';
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
        }

        input[type="color"] {
            position: absolute;
            inset: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* --- Preview --- */
        .preview-wrapper {
            position: relative;
        }

        .qr-stage {
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            background-color: #fcfcfc;
            border-radius: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
            border: 1px solid var(--bg-light);
            min-height: 200px; /* Reduced min-height */
            overflow: hidden;
        }

        .qr-canvas-container {
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qr-canvas-container canvas, 
        .qr-canvas-container svg {
            max-width: 100%;
            max-height: 100%; 
            /* Let flexbox handle sizing naturally */
            height: auto;
            width: auto;
        }

        .refresh-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #666;
            z-index: 5;
        }

        .status-pill {
            position: absolute;
            bottom: 10px;
            background: rgba(240, 249, 235, 0.9);
            color: var(--primary-green);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            backdrop-filter: blur(2px);
        }

        /* --- Buttons --- */
        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: auto;
            flex-shrink: 0;
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px 6px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }

        .action-btn i { margin-bottom: 3px; width: 18px; height: 18px; }

        .btn-primary { background-color: var(--primary-gray); color: white; }
        .btn-primary:hover { background-color: #2d2d2d; }

        .btn-secondary { background-color: var(--white); border: 2px solid var(--bg-light); color: var(--primary-gray); }
        .btn-secondary:hover { border-color: var(--primary-gray); }

        .btn-danger { background-color: #fff5f5; color: #c53030; border: 2px solid #fff5f5; }
        .btn-danger:hover { border-color: #feb2b2; }

        .btn-label { font-size: 0.6rem; opacity: 0.7; }
        .btn-text { font-weight: 700; font-size: 0.8rem; }

        /* Compact Logo Inputs */
        .compact-logo-inputs {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 6px;
            align-items: center;
        }
        .compact-or { font-size: 0.65rem; color: #ccc; font-weight: 600; }
        
    </style>
</head>
<body>

    <header>
        <h1>LS <span>QR CODE STUDIO</span></h1>
        <p class="subtitle">Generate custome QR codes with your brand logos or custom images</p>
    </header>

    <div class="app-container">
        
        <!-- LEFT: Configuration -->
        <div class="card">
            <div class="card-header">
                <i data-lucide="sliders-horizontal" width="18"></i>
                <span class="card-title">Configuration</span>
            </div>

            <!-- Compact Content Wrapper -->
            <div class="card-content">
                
                <!-- URL -->
                <div class="form-section">
                    <label>Target URL</label>
                    <div class="input-wrapper">
                        <input type="text" id="urlInput" value="Enjoy the new QR" placeholder="https://example.com">
                    </div>
                </div>

                <!-- Logo (Compact) -->
                <div class="form-section">
                    <label>Center Logo</label>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="useFavicon">
                        <span style="font-size: 0.8rem; color: var(--primary-gray);">Auto-fetch</span>
                    </div>

                    <div id="customLogoGroup" style="opacity: 1; pointer-events: auto; transition: opacity 0.3s;">
                        <div class="compact-logo-inputs">
                            <input type="url" id="logoUrlInput" placeholder="Image URL">
                            <span class="compact-or">OR</span>
                            <input type="file" id="logoFileInput" accept="image/*" style="padding: 6px;">
                        </div>
                    </div>
                </div>

                <!-- Patterns -->
                <div class="form-section">
                    <label>Pattern Style</label>
                    <div class="options-grid" id="dotTypeContainer">
                        <!-- JS populated -->
                    </div>
                </div>

                <!-- Corners -->
                <div class="form-section">
                    <label>Corner Style</label>
                    <div class="options-grid" id="cornerTypeContainer">
                        <!-- JS populated -->
                    </div>
                </div>

                <!-- Color -->
                <div class="form-section">
                    <label>Primary Color</label>
                    <div class="color-row">
                        <div id="colorPresets" style="display: contents;"></div>
                        <div class="custom-picker-wrapper" title="Custom Color">
                            <input type="color" id="colorPicker" value="#6eb944">
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- RIGHT: Preview -->
        <div class="card preview-wrapper">
            <div class="card-header">
                <i data-lucide="eye" width="18"></i>
                <span class="card-title">Preview</span>
            </div>

            <div class="card-content">
                <div class="qr-stage">
                    <button class="refresh-btn" onclick="forceRefresh()" title="Redraw">
                        <i data-lucide="refresh-cw" width="14"></i>
                    </button>
                    
                    <div class="qr-canvas-container" id="qr-container">
                        <!-- QR Code renders here -->
                    </div>

                    <div class="status-pill" id="statusPill">Ready to Scan</div>
                </div>

                <div class="btn-grid">
                    <button class="action-btn btn-primary" onclick="handleDownload('png')">
                        <i data-lucide="image"></i>
                        <span class="btn-label">Download</span>
                        <span class="btn-text">PNG</span>
                    </button>
                    <button class="action-btn btn-secondary" onclick="handleDownload('svg')">
                        <i data-lucide="file-code"></i>
                        <span class="btn-label">Download</span>
                        <span class="btn-text">SVG</span>
                    </button>
                    <button class="action-btn btn-danger" onclick="handleDownload('pdf')">
                        <i data-lucide="file-text"></i>
                        <span class="btn-label">Save as</span>
                        <span class="btn-text">PDF</span>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- APP LOGIC -->
    <script>
        // --- State Management ---
        const state = {
            url: 'Enjoy the new QR',
            logoUrl: '',
            useFavicon: false,
            dotType: 'dots',
            dotColor: '#6eb944', 
            cornerType: 'extra-rounded',
            cornerColor: '#6eb944',
            bgColor: '#ffffff'
        };

        let qrCode = null;
        let debounceTimer;

        // --- Config Constants ---
        const dotTypes = ['dots', 'rounded', 'classy', 'classy-rounded', 'square', 'extra-rounded'];
        const cornerTypes = ['square', 'extra-rounded', 'dot'];
        const presetColors = ['#6eb944', '#414042', '#000000', '#2563EB', '#DB2777'];

        // --- Elements ---
        const els = {
            url: document.getElementById('urlInput'),
            useFavicon: document.getElementById('useFavicon'),
            customLogoGroup: document.getElementById('customLogoGroup'),
            logoUrl: document.getElementById('logoUrlInput'),
            logoFile: document.getElementById('logoFileInput'),
            container: document.getElementById('qr-container'),
            status: document.getElementById('statusPill'),
            colorPicker: document.getElementById('colorPicker')
        };

        // --- Initialization ---
        window.onload = () => {
            lucide.createIcons();
            
            els.colorPicker.addEventListener('input', (e) => {
                setColor(e.target.value);
            });

            renderUIOptions();
            
            // Init QR Engine
            qrCode = new QRCodeStyling({
                width: 300,
                height: 300,
                type: 'svg',
                data: state.url,
                dotsOptions: { color: state.dotColor, type: state.dotType },
                backgroundOptions: { color: state.bgColor },
                imageOptions: { crossOrigin: 'anonymous', margin: 10 },
                cornersSquareOptions: { type: state.cornerType, color: state.cornerColor }
            });

            // Initial Render
            qrCode.append(els.container);
            updateQR();
        };

        // --- Core Update Logic ---
        async function updateQR() {
            if (!qrCode) return;

            let activeLogo = undefined;
            if (state.useFavicon && state.url && state.url.includes('.')) {
                try {
                    const domain = new URL(state.url).hostname;
                    activeLogo = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
                } catch(e) {}
            } else if (state.logoUrl) {
                activeLogo = state.logoUrl;
            }

            const base64Logo = activeLogo ? await convertImageToBase64(activeLogo) : undefined;

            qrCode.update({
                data: state.url,
                image: base64Logo,
                dotsOptions: { color: state.dotColor, type: state.dotType },
                cornersSquareOptions: { type: state.cornerType, color: state.cornerColor },
                backgroundOptions: { color: state.bgColor }
            });
        }

        function forceRefresh() {
            els.container.innerHTML = '';
            qrCode.append(els.container);
        }

        // --- UI Rendering ---
        function renderUIOptions() {
            const dotContainer = document.getElementById('dotTypeContainer');
            dotContainer.innerHTML = dotTypes.map(type => 
                `<div class="option-btn ${state.dotType === type ? 'active' : ''}" 
                      onclick="setOption('dotType', '${type}')">
                    ${type.replace('-', ' ')}
                 </div>`
            ).join('');

            const cornerContainer = document.getElementById('cornerTypeContainer');
            cornerContainer.innerHTML = cornerTypes.map(type => 
                `<div class="option-btn ${state.cornerType === type ? 'active' : ''}" 
                      onclick="setOption('cornerType', '${type}')">
                    ${type.replace('-', ' ')}
                 </div>`
            ).join('');

            const presetsContainer = document.getElementById('colorPresets');
            presetsContainer.innerHTML = presetColors.map(color => 
                `<div class="color-dot ${state.dotColor === color ? 'active' : ''}" 
                      style="background-color: ${color};"
                      onclick="setColor('${color}')">
                 </div>`
            ).join('');
        }

        // --- Setters ---
        window.setOption = (key, value) => {
            state[key] = value;
            renderUIOptions();
            updateQR();
        };

        window.setColor = (color) => {
            state.dotColor = color;
            state.cornerColor = color;
            els.colorPicker.value = color; 
            renderUIOptions();
            updateQR();
        };

        // --- Event Listeners ---
        els.url.addEventListener('input', (e) => {
            clearTimeout(debounceTimer);
            state.url = e.target.value;
            debounceTimer = setTimeout(updateQR, 300);
        });

        els.useFavicon.addEventListener('change', (e) => {
            state.useFavicon = e.target.checked;
            els.customLogoGroup.style.opacity = state.useFavicon ? '0.5' : '1';
            els.customLogoGroup.style.pointerEvents = state.useFavicon ? 'none' : 'auto';
            updateQR();
        });

        els.logoUrl.addEventListener('input', (e) => {
            state.logoUrl = e.target.value;
            updateQR();
        });

        els.logoFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    state.logoUrl = evt.target.result;
                    updateQR();
                };
                reader.readAsDataURL(file);
            }
        });

        // --- Utilities ---
        async function convertImageToBase64(url) {
            if (url.startsWith('data:')) return url;
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                return url;
            }
        }

        // --- Downloads ---
        window.handleDownload = async (format) => {
            els.status.innerText = "Generating...";
            els.status.style.background = "#fff3cd";
            els.status.style.color = "#856404";

            let activeLogo = undefined;
            if (state.useFavicon && state.url && state.url.includes('.')) {
                try {
                    const domain = new URL(state.url).hostname;
                    activeLogo = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
                } catch(e) {}
            } else if (state.logoUrl) {
                activeLogo = state.logoUrl;
            }
            const base64Logo = activeLogo ? await convertImageToBase64(activeLogo) : undefined;

            const dlQr = new QRCodeStyling({
                width: 2000,
                height: 2000,
                type: 'svg',
                data: state.url,
                image: base64Logo,
                dotsOptions: { color: state.dotColor, type: state.dotType },
                backgroundOptions: { color: state.bgColor },
                cornersSquareOptions: { type: state.cornerType, color: state.cornerColor },
                imageOptions: { crossOrigin: 'anonymous', margin: 20 }
            });

            try {
                if (format === 'pdf') {
                    const blob = await dlQr.getRawData('png');
                    const reader = new FileReader();
                    reader.readAsDataURL(blob);
                    reader.onloadend = () => {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        doc.setFont("helvetica", "bold");
                        doc.text("Scan QR Code", 105, 40, { align: "center" });
                        doc.addImage(reader.result, 'PNG', 55, 50, 100, 100); 
                        
                        doc.setFont("helvetica", "normal");
                        doc.setFontSize(10);
                        doc.text(state.url.substring(0, 60), 105, 160, { align: "center" });
                        
                        doc.save("mhg-qrcode.pdf");
                        resetStatus();
                    };
                } else {
                    await dlQr.download({ name: "mhg-qrcode", extension: format });
                    resetStatus();
                }
            } catch (e) {
                alert("Download error. Check logo CORS permissions.");
                resetStatus();
            }
        };

        function resetStatus() {
            els.status.innerText = "Ready to Scan";
            els.status.style.background = "#f0f9eb";
            els.status.style.color = "#6eb944";
        }

    </script>
</body>
</html>
